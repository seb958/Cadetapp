{"dependencies":[{"name":"../interfaces","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":15},"end":{"line":3,"column":43,"index":58}}],"key":"GMKh3a5g5xNaAog15vl07v6pG2U=","exportNames":["*"],"imports":1}},{"name":"./EventManager","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":59},"end":{"line":4,"column":42,"index":101}}],"key":"+tTRfUGWY5rcrw6ZVLEgvlFTMQc=","exportNames":["*"],"imports":1}},{"name":"../../PointerType","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":102},"end":{"line":5,"column":48,"index":150}}],"key":"PNpP2j+zRZwLQ3w6ZmXPMJNakiU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return KeyboardEventManager;\n    }\n  });\n  var _interfaces = require(_dependencyMap[0], \"../interfaces\");\n  var _EventManager = require(_dependencyMap[1], \"./EventManager\");\n  var EventManager = _interopDefault(_EventManager);\n  var _PointerType = require(_dependencyMap[2], \"../../PointerType\");\n  class KeyboardEventManager extends EventManager.default {\n    static activationKeys = ['Enter', ' '];\n    static cancelationKeys = ['Tab'];\n    isPressed = false;\n    static registeredStaticListeners = false;\n    static instances = new Set();\n    static keyUpStaticCallback = event => {\n      // We need a global listener, as in some cases, keyUp event gets stop-propagated.\n      // Then, if we used only component-level listeners the gesture would never end,\n      // causing other gestues to fail.\n\n      if (this.activationKeys.indexOf(event.key) === -1) {\n        return;\n      }\n      this.instances.forEach(item => {\n        item.onKeyUp(event);\n      });\n    };\n    keyDownCallback = event => {\n      if (KeyboardEventManager.cancelationKeys.indexOf(event.key) !== -1 && this.isPressed) {\n        this.dispatchEvent(event, _interfaces.EventTypes.CANCEL);\n        return;\n      }\n      if (KeyboardEventManager.activationKeys.indexOf(event.key) === -1) {\n        return;\n      }\n      this.dispatchEvent(event, _interfaces.EventTypes.DOWN);\n    };\n    onKeyUp = event => {\n      if (KeyboardEventManager.activationKeys.indexOf(event.key) === -1 || !this.isPressed) {\n        return;\n      }\n      this.dispatchEvent(event, _interfaces.EventTypes.UP);\n    };\n    dispatchEvent(event, eventType) {\n      if (!(event.target instanceof HTMLElement)) {\n        return;\n      }\n      const adaptedEvent = this.mapEvent(event, eventType);\n      switch (eventType) {\n        case _interfaces.EventTypes.UP:\n          this.isPressed = false;\n          this.onPointerUp(adaptedEvent);\n          break;\n        case _interfaces.EventTypes.DOWN:\n          this.isPressed = true;\n          this.onPointerDown(adaptedEvent);\n          break;\n        case _interfaces.EventTypes.CANCEL:\n          this.isPressed = false;\n          this.onPointerCancel(adaptedEvent);\n          break;\n      }\n    }\n    registerListeners() {\n      this.view.addEventListener('keydown', this.keyDownCallback);\n      KeyboardEventManager.instances.add(this);\n      if (!KeyboardEventManager.registeredStaticListeners) {\n        KeyboardEventManager.registeredStaticListeners = true;\n        document.addEventListener('keyup', KeyboardEventManager.keyUpStaticCallback, {\n          capture: true\n        });\n      }\n    }\n    unregisterListeners() {\n      this.view.removeEventListener('keydown', this.keyDownCallback);\n      KeyboardEventManager.instances.delete(this);\n      if (KeyboardEventManager.instances.size === 0) {\n        document.removeEventListener('keyup', KeyboardEventManager.keyUpStaticCallback, {\n          capture: true\n        });\n        KeyboardEventManager.registeredStaticListeners = false;\n      }\n    }\n    mapEvent(event, eventType) {\n      const viewRect = event.target.getBoundingClientRect();\n      const viewportPosition = {\n        x: viewRect?.x + viewRect?.width / 2,\n        y: viewRect?.y + viewRect?.height / 2\n      };\n      const relativePosition = {\n        x: viewRect?.width / 2,\n        y: viewRect?.height / 2\n      };\n      return {\n        x: viewportPosition.x,\n        y: viewportPosition.y,\n        offsetX: relativePosition.x,\n        offsetY: relativePosition.y,\n        pointerId: 0,\n        eventType: eventType,\n        pointerType: _PointerType.PointerType.KEY,\n        time: event.timeStamp\n      };\n    }\n  }\n});","lineCount":118,"map":[[2,2,1,0],[2,14,1,12],[4,2,1,13,"Object"],[4,8,1,13],[4,9,1,13,"defineProperty"],[4,23,1,13],[4,24,1,13,"exports"],[4,31,1,13],[5,4,1,13,"value"],[5,9,1,13],[6,2,1,13],[7,2,1,13],[7,11,1,13,"_interopDefault"],[7,27,1,13,"e"],[7,28,1,13],[8,4,1,13],[8,11,1,13,"e"],[8,12,1,13],[8,16,1,13,"e"],[8,17,1,13],[8,18,1,13,"__esModule"],[8,28,1,13],[8,31,1,13,"e"],[8,32,1,13],[9,6,1,13,"default"],[9,13,1,13],[9,15,1,13,"e"],[10,4,1,13],[11,2,1,13],[12,2,6,15,"Object"],[12,8,6,15],[12,9,6,15,"defineProperty"],[12,23,6,15],[12,24,6,15,"exports"],[12,31,6,15],[13,4,6,15,"enumerable"],[13,14,6,15],[14,4,6,15,"get"],[14,7,6,15],[14,18,6,15,"get"],[14,19,6,15],[15,6,6,15],[15,13,6,15,"KeyboardEventManager"],[15,33,6,15],[16,4,6,15],[17,2,6,15],[18,2,3,0],[18,6,3,0,"_interfaces"],[18,17,3,0],[18,20,3,0,"require"],[18,27,3,0],[18,28,3,0,"_dependencyMap"],[18,42,3,0],[19,2,4,0],[19,6,4,0,"_EventManager"],[19,19,4,0],[19,22,4,0,"require"],[19,29,4,0],[19,30,4,0,"_dependencyMap"],[19,44,4,0],[20,2,4,0],[20,6,4,0,"EventManager"],[20,18,4,0],[20,21,4,0,"_interopDefault"],[20,36,4,0],[20,37,4,0,"_EventManager"],[20,50,4,0],[21,2,5,0],[21,6,5,0,"_PointerType"],[21,18,5,0],[21,21,5,0,"require"],[21,28,5,0],[21,29,5,0,"_dependencyMap"],[21,43,5,0],[22,2,6,15],[22,8,6,21,"KeyboardEventManager"],[22,28,6,41],[22,37,6,50,"EventManager"],[22,49,6,62],[22,50,6,62,"default"],[22,57,6,62],[22,58,6,63],[23,4,7,2],[23,11,7,9,"activationKeys"],[23,25,7,23],[23,28,7,26],[23,29,7,27],[23,36,7,34],[23,38,7,36],[23,41,7,39],[23,42,7,40],[24,4,8,2],[24,11,8,9,"cancelationKeys"],[24,26,8,24],[24,29,8,27],[24,30,8,28],[24,35,8,33],[24,36,8,34],[25,4,9,2,"isPressed"],[25,13,9,11],[25,16,9,14],[25,21,9,19],[26,4,10,2],[26,11,10,9,"registeredStaticListeners"],[26,36,10,34],[26,39,10,37],[26,44,10,42],[27,4,11,2],[27,11,11,9,"instances"],[27,20,11,18],[27,23,11,21],[27,27,11,25,"Set"],[27,30,11,28],[27,31,11,29],[27,32,11,30],[28,4,12,2],[28,11,12,9,"keyUpStaticCallback"],[28,30,12,28],[28,33,12,31,"event"],[28,38,12,36],[28,42,12,40],[29,6,13,4],[30,6,14,4],[31,6,15,4],[33,6,17,4],[33,10,17,8],[33,14,17,12],[33,15,17,13,"activationKeys"],[33,29,17,27],[33,30,17,28,"indexOf"],[33,37,17,35],[33,38,17,36,"event"],[33,43,17,41],[33,44,17,42,"key"],[33,47,17,45],[33,48,17,46],[33,53,17,51],[33,54,17,52],[33,55,17,53],[33,57,17,55],[34,8,18,6],[35,6,19,4],[36,6,20,4],[36,10,20,8],[36,11,20,9,"instances"],[36,20,20,18],[36,21,20,19,"forEach"],[36,28,20,26],[36,29,20,27,"item"],[36,33,20,31],[36,37,20,35],[37,8,21,6,"item"],[37,12,21,10],[37,13,21,11,"onKeyUp"],[37,20,21,18],[37,21,21,19,"event"],[37,26,21,24],[37,27,21,25],[38,6,22,4],[38,7,22,5],[38,8,22,6],[39,4,23,2],[39,5,23,3],[40,4,24,2,"keyDownCallback"],[40,19,24,17],[40,22,24,20,"event"],[40,27,24,25],[40,31,24,29],[41,6,25,4],[41,10,25,8,"KeyboardEventManager"],[41,30,25,28],[41,31,25,29,"cancelationKeys"],[41,46,25,44],[41,47,25,45,"indexOf"],[41,54,25,52],[41,55,25,53,"event"],[41,60,25,58],[41,61,25,59,"key"],[41,64,25,62],[41,65,25,63],[41,70,25,68],[41,71,25,69],[41,72,25,70],[41,76,25,74],[41,80,25,78],[41,81,25,79,"isPressed"],[41,90,25,88],[41,92,25,90],[42,8,26,6],[42,12,26,10],[42,13,26,11,"dispatchEvent"],[42,26,26,24],[42,27,26,25,"event"],[42,32,26,30],[42,34,26,32,"EventTypes"],[42,45,26,42],[42,46,26,42,"EventTypes"],[42,56,26,42],[42,57,26,43,"CANCEL"],[42,63,26,49],[42,64,26,50],[43,8,27,6],[44,6,28,4],[45,6,29,4],[45,10,29,8,"KeyboardEventManager"],[45,30,29,28],[45,31,29,29,"activationKeys"],[45,45,29,43],[45,46,29,44,"indexOf"],[45,53,29,51],[45,54,29,52,"event"],[45,59,29,57],[45,60,29,58,"key"],[45,63,29,61],[45,64,29,62],[45,69,29,67],[45,70,29,68],[45,71,29,69],[45,73,29,71],[46,8,30,6],[47,6,31,4],[48,6,32,4],[48,10,32,8],[48,11,32,9,"dispatchEvent"],[48,24,32,22],[48,25,32,23,"event"],[48,30,32,28],[48,32,32,30,"EventTypes"],[48,43,32,40],[48,44,32,40,"EventTypes"],[48,54,32,40],[48,55,32,41,"DOWN"],[48,59,32,45],[48,60,32,46],[49,4,33,2],[49,5,33,3],[50,4,34,2,"onKeyUp"],[50,11,34,9],[50,14,34,12,"event"],[50,19,34,17],[50,23,34,21],[51,6,35,4],[51,10,35,8,"KeyboardEventManager"],[51,30,35,28],[51,31,35,29,"activationKeys"],[51,45,35,43],[51,46,35,44,"indexOf"],[51,53,35,51],[51,54,35,52,"event"],[51,59,35,57],[51,60,35,58,"key"],[51,63,35,61],[51,64,35,62],[51,69,35,67],[51,70,35,68],[51,71,35,69],[51,75,35,73],[51,76,35,74],[51,80,35,78],[51,81,35,79,"isPressed"],[51,90,35,88],[51,92,35,90],[52,8,36,6],[53,6,37,4],[54,6,38,4],[54,10,38,8],[54,11,38,9,"dispatchEvent"],[54,24,38,22],[54,25,38,23,"event"],[54,30,38,28],[54,32,38,30,"EventTypes"],[54,43,38,40],[54,44,38,40,"EventTypes"],[54,54,38,40],[54,55,38,41,"UP"],[54,57,38,43],[54,58,38,44],[55,4,39,2],[55,5,39,3],[56,4,40,2,"dispatchEvent"],[56,17,40,15,"dispatchEvent"],[56,18,40,16,"event"],[56,23,40,21],[56,25,40,23,"eventType"],[56,34,40,32],[56,36,40,34],[57,6,41,4],[57,10,41,8],[57,12,41,10,"event"],[57,17,41,15],[57,18,41,16,"target"],[57,24,41,22],[57,36,41,34,"HTMLElement"],[57,47,41,45],[57,48,41,46],[57,50,41,48],[58,8,42,6],[59,6,43,4],[60,6,44,4],[60,12,44,10,"adaptedEvent"],[60,24,44,22],[60,27,44,25],[60,31,44,29],[60,32,44,30,"mapEvent"],[60,40,44,38],[60,41,44,39,"event"],[60,46,44,44],[60,48,44,46,"eventType"],[60,57,44,55],[60,58,44,56],[61,6,45,4],[61,14,45,12,"eventType"],[61,23,45,21],[62,8,46,6],[62,13,46,11,"EventTypes"],[62,24,46,21],[62,25,46,21,"EventTypes"],[62,35,46,21],[62,36,46,22,"UP"],[62,38,46,24],[63,10,47,8],[63,14,47,12],[63,15,47,13,"isPressed"],[63,24,47,22],[63,27,47,25],[63,32,47,30],[64,10,48,8],[64,14,48,12],[64,15,48,13,"onPointerUp"],[64,26,48,24],[64,27,48,25,"adaptedEvent"],[64,39,48,37],[64,40,48,38],[65,10,49,8],[66,8,50,6],[66,13,50,11,"EventTypes"],[66,24,50,21],[66,25,50,21,"EventTypes"],[66,35,50,21],[66,36,50,22,"DOWN"],[66,40,50,26],[67,10,51,8],[67,14,51,12],[67,15,51,13,"isPressed"],[67,24,51,22],[67,27,51,25],[67,31,51,29],[68,10,52,8],[68,14,52,12],[68,15,52,13,"onPointerDown"],[68,28,52,26],[68,29,52,27,"adaptedEvent"],[68,41,52,39],[68,42,52,40],[69,10,53,8],[70,8,54,6],[70,13,54,11,"EventTypes"],[70,24,54,21],[70,25,54,21,"EventTypes"],[70,35,54,21],[70,36,54,22,"CANCEL"],[70,42,54,28],[71,10,55,8],[71,14,55,12],[71,15,55,13,"isPressed"],[71,24,55,22],[71,27,55,25],[71,32,55,30],[72,10,56,8],[72,14,56,12],[72,15,56,13,"onPointerCancel"],[72,30,56,28],[72,31,56,29,"adaptedEvent"],[72,43,56,41],[72,44,56,42],[73,10,57,8],[74,6,58,4],[75,4,59,2],[76,4,60,2,"registerListeners"],[76,21,60,19,"registerListeners"],[76,22,60,19],[76,24,60,22],[77,6,61,4],[77,10,61,8],[77,11,61,9,"view"],[77,15,61,13],[77,16,61,14,"addEventListener"],[77,32,61,30],[77,33,61,31],[77,42,61,40],[77,44,61,42],[77,48,61,46],[77,49,61,47,"keyDownCallback"],[77,64,61,62],[77,65,61,63],[78,6,62,4,"KeyboardEventManager"],[78,26,62,24],[78,27,62,25,"instances"],[78,36,62,34],[78,37,62,35,"add"],[78,40,62,38],[78,41,62,39],[78,45,62,43],[78,46,62,44],[79,6,63,4],[79,10,63,8],[79,11,63,9,"KeyboardEventManager"],[79,31,63,29],[79,32,63,30,"registeredStaticListeners"],[79,57,63,55],[79,59,63,57],[80,8,64,6,"KeyboardEventManager"],[80,28,64,26],[80,29,64,27,"registeredStaticListeners"],[80,54,64,52],[80,57,64,55],[80,61,64,59],[81,8,65,6,"document"],[81,16,65,14],[81,17,65,15,"addEventListener"],[81,33,65,31],[81,34,65,32],[81,41,65,39],[81,43,65,41,"KeyboardEventManager"],[81,63,65,61],[81,64,65,62,"keyUpStaticCallback"],[81,83,65,81],[81,85,65,83],[82,10,66,8,"capture"],[82,17,66,15],[82,19,66,17],[83,8,67,6],[83,9,67,7],[83,10,67,8],[84,6,68,4],[85,4,69,2],[86,4,70,2,"unregisterListeners"],[86,23,70,21,"unregisterListeners"],[86,24,70,21],[86,26,70,24],[87,6,71,4],[87,10,71,8],[87,11,71,9,"view"],[87,15,71,13],[87,16,71,14,"removeEventListener"],[87,35,71,33],[87,36,71,34],[87,45,71,43],[87,47,71,45],[87,51,71,49],[87,52,71,50,"keyDownCallback"],[87,67,71,65],[87,68,71,66],[88,6,72,4,"KeyboardEventManager"],[88,26,72,24],[88,27,72,25,"instances"],[88,36,72,34],[88,37,72,35,"delete"],[88,43,72,41],[88,44,72,42],[88,48,72,46],[88,49,72,47],[89,6,73,4],[89,10,73,8,"KeyboardEventManager"],[89,30,73,28],[89,31,73,29,"instances"],[89,40,73,38],[89,41,73,39,"size"],[89,45,73,43],[89,50,73,48],[89,51,73,49],[89,53,73,51],[90,8,74,6,"document"],[90,16,74,14],[90,17,74,15,"removeEventListener"],[90,36,74,34],[90,37,74,35],[90,44,74,42],[90,46,74,44,"KeyboardEventManager"],[90,66,74,64],[90,67,74,65,"keyUpStaticCallback"],[90,86,74,84],[90,88,74,86],[91,10,75,8,"capture"],[91,17,75,15],[91,19,75,17],[92,8,76,6],[92,9,76,7],[92,10,76,8],[93,8,77,6,"KeyboardEventManager"],[93,28,77,26],[93,29,77,27,"registeredStaticListeners"],[93,54,77,52],[93,57,77,55],[93,62,77,60],[94,6,78,4],[95,4,79,2],[96,4,80,2,"mapEvent"],[96,12,80,10,"mapEvent"],[96,13,80,11,"event"],[96,18,80,16],[96,20,80,18,"eventType"],[96,29,80,27],[96,31,80,29],[97,6,81,4],[97,12,81,10,"viewRect"],[97,20,81,18],[97,23,81,21,"event"],[97,28,81,26],[97,29,81,27,"target"],[97,35,81,33],[97,36,81,34,"getBoundingClientRect"],[97,57,81,55],[97,58,81,56],[97,59,81,57],[98,6,82,4],[98,12,82,10,"viewportPosition"],[98,28,82,26],[98,31,82,29],[99,8,83,6,"x"],[99,9,83,7],[99,11,83,9,"viewRect"],[99,19,83,17],[99,21,83,19,"x"],[99,22,83,20],[99,25,83,23,"viewRect"],[99,33,83,31],[99,35,83,33,"width"],[99,40,83,38],[99,43,83,41],[99,44,83,42],[100,8,84,6,"y"],[100,9,84,7],[100,11,84,9,"viewRect"],[100,19,84,17],[100,21,84,19,"y"],[100,22,84,20],[100,25,84,23,"viewRect"],[100,33,84,31],[100,35,84,33,"height"],[100,41,84,39],[100,44,84,42],[101,6,85,4],[101,7,85,5],[102,6,86,4],[102,12,86,10,"relativePosition"],[102,28,86,26],[102,31,86,29],[103,8,87,6,"x"],[103,9,87,7],[103,11,87,9,"viewRect"],[103,19,87,17],[103,21,87,19,"width"],[103,26,87,24],[103,29,87,27],[103,30,87,28],[104,8,88,6,"y"],[104,9,88,7],[104,11,88,9,"viewRect"],[104,19,88,17],[104,21,88,19,"height"],[104,27,88,25],[104,30,88,28],[105,6,89,4],[105,7,89,5],[106,6,90,4],[106,13,90,11],[107,8,91,6,"x"],[107,9,91,7],[107,11,91,9,"viewportPosition"],[107,27,91,25],[107,28,91,26,"x"],[107,29,91,27],[108,8,92,6,"y"],[108,9,92,7],[108,11,92,9,"viewportPosition"],[108,27,92,25],[108,28,92,26,"y"],[108,29,92,27],[109,8,93,6,"offsetX"],[109,15,93,13],[109,17,93,15,"relativePosition"],[109,33,93,31],[109,34,93,32,"x"],[109,35,93,33],[110,8,94,6,"offsetY"],[110,15,94,13],[110,17,94,15,"relativePosition"],[110,33,94,31],[110,34,94,32,"y"],[110,35,94,33],[111,8,95,6,"pointerId"],[111,17,95,15],[111,19,95,17],[111,20,95,18],[112,8,96,6,"eventType"],[112,17,96,15],[112,19,96,17,"eventType"],[112,28,96,26],[113,8,97,6,"pointerType"],[113,19,97,17],[113,21,97,19,"PointerType"],[113,33,97,30],[113,34,97,30,"PointerType"],[113,45,97,30],[113,46,97,31,"KEY"],[113,49,97,34],[114,8,98,6,"time"],[114,12,98,10],[114,14,98,12,"event"],[114,19,98,17],[114,20,98,18,"timeStamp"],[115,6,99,4],[115,7,99,5],[116,4,100,2],[117,2,101,0],[118,0,101,1],[118,3]],"functionMap":{"names":["<global>","KeyboardEventManager","keyUpStaticCallback","instances.forEach$argument_0","keyDownCallback","onKeyUp","dispatchEvent","registerListeners","unregisterListeners","mapEvent"],"mappings":"AAA;eCK;+BCM;2BCQ;KDE;GDC;oBGC;GHS;YIC;GJK;EKC;GLmB;EMC;GNS;EOC;GPS;EQC;GRoB;CDC"},"hasCjsExports":false},"type":"js/module"}]}